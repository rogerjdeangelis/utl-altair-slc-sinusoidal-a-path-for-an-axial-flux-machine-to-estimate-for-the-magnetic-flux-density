# utl-altair-slc-sinusoidal-a-path-for-an-axial-flux-machine-to-estimate-for-the-magnetic-flux-density
Altair slc sinusoidal a path for an axial flux machine to estimate for the magnetic flux density
    %let pgm=utl-altair-slc-sinusoidal-a-path-for-an-axial-flux-machine-to-estimate-for-the-magnetic-flux-density;

    %stop_submission;

    Altair slc sinusoidal a path for an axial flux machine to estimate for the magnetic flux density

    Too long to post on lists, see github
     https://github.com/rogerjdeangelis/utl-altair-slc-sinusoidal-a-path-for-an-axial-flux-machine-to-estimate-for-the-magnetic-flux-density
     
    Graphic
    https://github.com/rogerjdeangelis/utl-altair-slc-sinusoidal-a-path-for-an-axial-flux-machine-to-estimate-for-the-magnetic-flux-density/blob/main/axial_flux_analysis.pdf

    SUMMARY (table ADDLABELS)

      Variable     Typ      Value        Formula

      MAX_B         N8       1.56     round(max(B_mag), 3)
      MIN_B         N8      -1.56     round(min(B_mag), 3)
      AVG_B         N8      0.605     round(mean(abs(B_mag)), 3)
      RMS_B         N8      0.817     round(sqrt(mean(B_mag^2)), 3)


      These metrics characterize the B-field variation generated by `B_peak * (cos(phi) +
      0.3 * cos(3 * phi))` where `phi = freq * theta`.

     - **MAX_B (1.56 T)**: Peak positive magnetic
      flux density. Occurs when `cos(phi) + 0.3*cos(3*phi)` reaches +1—your design's maximum field
      strength.
      [web.mit](https://web.mit.edu/kirtley/binlustuff/literature/electric%20machine/designOfAxialFluxPMM.
      pdf)

     - **MIN_B (-1.56 T)**: Peak negative flux density. Symmetric due to cosine terms; shows
      full alternating field swing typical in axial flux machines.
      [traxial](https://traxial.com/blog/electric-motor-design-magnetic-field-orientation/)

     - **AVG_B
      (0.605 T)**: Mean of absolute B_mag values. Captures average rectified field strength
      (`mean(abs(B_mag))`), relevant for torque averaging since direction reverses but magnitude drives
      force. [leili-motor](https://www.leili-motor.net/an-ultimate-guide-to-axial-flux-motors/)

     - **RMS_B (0.817 T)**: Root mean square \(\sqrt{\frac{1}{N}\sum B_{mag}^2}\). Best metric for
      power/heating calcs as it weights higher magnitudes quadratically—standard for AC fields in motor
      design.
      [web.mit](https://web.mit.edu/kirtley/binlustuff/literature/electric%20machine/designOfAxialFluxPMM.
      pdf)

     ## Design Context
     Your values indicate a strong NdFeB magnet design (B_peak implies
      ~1.56 T peak airgap flux, realistic for axial flux PM machines). RMS_B 52% of peak aligns with
      ~3rd harmonic modulation; expect good torque from this field profile. AVG_B > RMS_B/v2 suggests
      peaked waveform favoring peaky torque delivery.
      [leili-motor](https://www.leili-motor.net/an-ultimate-guide-to-axial-flux-motors/)

    Here is python solution?
    python example of How do i create a sinusoidal a path for an axial flux machine to estimate for the magnetic flux density
    https://www.perplexity.ai/search/python-example-of-how-do-i-cre-jwMw5rPTSFW396_WczReJw

    /*                   _
    (_)_ __  _ __  _   _| |_
    | | `_ \| `_ \| | | | __|
    | | | | | |_) | |_| | |_
    |_|_| |_| .__/ \__,_|\__|
            |_|
    */
    
    /*--- sinusoidal plot ---*/
    %utlfkil(d:/pdf/sinusoidal_path_xy.pdf);     XY Path Projection
    %utlfkil(d:/pdf/flux_density_path.pdf);      Flux Density vs Z
    %utlfkil(d:/pdf/axial_flux_analysis.pdf);    Combined Analysis

    %utlfkil(d:/csv/axial_flux_path_data.csv);

    proc delete
                data=workx.params                 /*--- input  ---*/
                     workx.axial_flux_path_data   /*--- output ---*/
                     workx.summary_stats ;        /*--- output ---*/
    run;quit;

    options validvarname=v7 ls=255;
    data workx.params;
     label
       r_inner       =  "Inner radius (m)            "
       r_outer       =  "Outer radius (m)            "
       axial_length  =  "Axial stack length (m)      "
       num_turns     =  "Sinusoidal turns along z    "
       B_peak        =  "Peak flux density (T)       "
       freq          =  "Harmonic frequency (poles/2)"
       ;
      r_inner = 0.05;      * Inner radius (m)            ;
     r_outer = 0.15;      * Outer radius (m)            ;
     axial_length = 0.02; * Axial stack length (m)      ;
     num_turns = 2;       * Sinusoidal turns along z    ;
     B_peak = 1.2;        * Peak flux density (T)       ;
     freq = 4;            * Harmonic frequency (poles/2);
    run;

    /**************************************************************************************************************************/
    /*  Middle Observation(1 ) of table = workx.params - Total Obs 1                                                          */
    /*                                                                                                                        */
    /* -- NUMERIC --                                                                                                          */
    /*                                                                                                                        */
    /* Variable          Type   Value           Label                                                                         */
    /*                                                                                                                        */
    /* r_inner            N8     0.05    Inner radius (m)                                                                     */
    /* r_outer            N8     0.15    Outer radius (m)                                                                     */
    /* axial_length       N8     0.02    Axial stack length (m)                                                               */
    /* num_turns          N8        2    Sinusoidal turns along z                                                             */
    /* B_peak             N8      1.2    Peak flux density (T)                                                                */
    /* freq               N8        4    Harmonic frequency (poles/2)                                                         */
    /**************************************************************************************************************************/

    /*
     _ __  _ __ ___   ___ ___  ___ ___
    | `_ \| `__/ _ \ / __/ _ \/ __/ __|
    | |_) | | | (_) | (_|  __/\__ \__ \
    | .__/|_|  \___/ \___\___||___/___/
    |_|
    */

    options set=RHOME "C:\\Progra~1\\R\\R-4.5.2\\bin\\r";
    proc r;
    export data=workx.params r=params_df;
    submit;
    library(tidyverse)  /* Only for data manipulation, not plotting */
    library(dplyr)

    generate_path <- function(row, n_points = 1000) {
      z <- seq(0, row$axial_length, length.out = n_points)
      theta <- 2 * pi * row$num_turns * (z / row$axial_length) +
               sin(2 * pi * z / (row$axial_length / 4))
      r <- seq(row$r_inner, row$r_outer, length.out = n_points)

      x <- r * cos(theta)
      y <- r * sin(theta)

      phi <- row$freq * theta
      B_mag <- row$B_peak * (cos(phi) + 0.3 * cos(3 * phi))

      data.frame(z = z, theta = theta, r = r, x = x, y = y, B_mag = B_mag)
    }

    # Generate path data
    paths_df <- generate_path(params_df)

    ## PDF 1: XY Path Projection (BASE R)
    pdf("d:/pdf/sinusoidal_path_xy.pdf", width = 10, height = 8)
    plot(paths_df$x, paths_df$y, type="l", col="blue", lwd=3,
         xlab="X (m)", ylab="Y (m)",
         main="Sinusoidal Path - XY Projection", cex.main=1.4)
    grid(col="gray", lwd=2)
    invisible(dev.off())

    ## PDF 2: Flux Density vs Z (BASE R)
    pdf("d:/pdf/flux_density_path.pdf", width = 10, height = 6)
    plot(paths_df$z * 1000, paths_df$B_mag, type="l", col="red", lwd=3,
         xlab="Axial position z (mm)", ylab="B magnitude (T)",
         main="Estimated Flux Density along Path", cex.main=1.4)
    grid(col="gray", lwd=1)
    invisible(dev.off())

    ## PDF 3: Combined Analysis (BASE R)
    pdf("d:/pdf/axial_flux_analysis.pdf", width = 12, height = 10)
    par(mfrow=c(2,1), mar=c(4.5,4.5,3,2), oma=c(0,0,2,0))

    # Top: B magnitude vs z
    plot(paths_df$z * 1000, paths_df$B_mag, type="l", col="red", lwd=3,
         xlab="", ylab="B magnitude (T)", cex.lab=1.2, cex.axis=1.1)
    grid(col="gray", lwd=1)
    title("Flux Density along Path", line=0.5)

    # Bottom: XY projection
    plot(paths_df$x, paths_df$y, type="l", col="blue", lwd=3,
         xlab="X (m)", ylab="Y (m)", cex.lab=1.2, cex.axis=1.1, asp=1)
    grid(col="gray", lwd=1)
    title("XY Path Projection", line=0.5)

    mtext("Axial Flux Machine Sinusoidal Path Analysis", outer=TRUE, cex=1.4)
    invisible(dev.off())

    # Summary statistics
    summary_stats <- paths_df %>%
      summarise(
        Max_B = round(max(B_mag), 3),
        Min_B = round(min(B_mag), 3),
        Avg_B = round(mean(abs(B_mag)), 3),
        RMS_B = round(sqrt(mean(B_mag^2)), 3)
      )
    print(summary_stats)

    # Export path data to CSV for SAS
    write.csv(paths_df, "d:/csv/axial_flux_path_data.csv", row.names=FALSE)

    cat("SUCCESS: PDF files created:\n")
    cat("- sinusoidal_path_xy.pdf\n")
    cat("- d:/pdf/flux_density_path.pdf\n")
    cat("- axial_flux_analysis.pdf\n")
    cat("- axial_flux_path_data.csv\n")
    endsubmit;
    import data=workx.axial_flux_path_data r=paths_df;
    import data=workx.summary_stats r=summary_stats;
    run;quit;


    data addlabels;
      label
         MAX_B =  'round(max(B_mag), 3)'
         MIN_B =  'round(min(B_mag), 3)'
         AVG_B =  'round(mean(abs(B_mag)), 3)'
         RMS_B =  'round(sqrt(mean(B_mag^2)), 3)'
         ;
      set
         workx.summary_stats;
    run;quit;
                  s
    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /* Graphica                                                                                                               */
    /*                                                                                                                        */
    /* d:/pdf/sinusoidal_path_xy.pdf       XY Path Projection                                                                 */
    /* d:/pdf/flux_density_path.pdf        Flux Density vs Z                                                                  */
    /* d:/pdf/axial_flux_analysis.pdf      Combined Analysis                                                                  */
    /*                                                                                                                        */
    /* d:/csv/axial_flux_path_data.csv     same as table workx.axial_flux_path_data                                           */
    /*                                                                                                                        */
    /* WORKX.AXIAL_FLUX_PATH_DATA total obs=1,000                                                                             */
    /* Obs        Z         THETA         R           X           Y         B_MAG                                             */
    /*                                                                                                                        */
    /*    1    .00000000    0.00000    0.050000    0.050000    0.000000     1.56000                                           */
    /*    2    .00002002    0.03773    0.050100    0.050064    0.001890     1.51008                                           */
    /*    3    .00004004    0.07545    0.050200    0.050057    0.003784     1.36801                                           */
    /*    4    .00006006    0.11314    0.050300    0.049979    0.005679     1.15535                                           */
    /*    5    .00008008    0.15078    0.050400    0.049829    0.007570     0.90323                                           */
    /*  ...                                                                                                                   */
    /*  996     0.019920    12.4156     0.14960     0.14790    -0.02247     0.90323                                           */
    /*  997     0.019940    12.4532     0.14970     0.14874    -0.01690     1.15535                                           */
    /*  998     0.019960    12.4909     0.14980     0.14937    -0.01129     1.36801                                           */
    /*  999     0.019980    12.5286     0.14990     0.14979    -0.00566     1.51008                                           */
    /* 1000     0.020000    12.5664     0.15000     0.15000    -0.00000     1.56000                                           */
    /*                                                                                                                        */
    /*  Middle Observation(1 ) of table = addlabels - Total Obs 1                                                             */
    /*                                                                                                                        */
    /*   -- NUMERIC --                                                                                                        */
    /*                                                                                                                        */
    /*  Variable     Typ           Value        Formula                                                                       */
    /*                                                                                                                        */
    /*  MAX_B         N8            1.56     round(max(B_mag), 3)                                                             */
    /*  MIN_B         N8           -1.56     round(min(B_mag), 3)                                                             */
    /*  AVG_B         N8           0.605     round(mean(abs(B_mag)), 3)                                                       */
    /*  RMS_B         N8           0.817     round(sqrt(mean(B_mag^2)), 3)                                                    */
    /*                                                                                                                        */
    /**************************************************************************************************************************/

    /*              _
      ___ _ __   __| |
     / _ \ `_ \ / _` |
    |  __/ | | | (_| |
     \___|_| |_|\__,_|

    */
